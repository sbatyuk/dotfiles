- name: Install vscode with homebrew
  community.general.homebrew_cask:
    name: visual-studio-code
    state: present

- name: Create vscode config directory
  ansible.builtin.file:
    path: '~/Library/Application Support/Code/User'
    state: directory

- name: Setup vscode symlinks
  ansible.builtin.file:
    src:  '{{ item.src }}'
    path: '{{ item.path }}'
    state: link
  loop:
    - { src: '{{ DOTFILES_REPO }}/roles/vscode/files/settings.json',    path: '~/Library/Application Support/Code/User/settings.json'     }
    - { src: '{{ DOTFILES_REPO }}/roles/vscode/files/keybindings.json', path: '~/Library/Application Support/Code/User/keybindings.json'  }

- name: Disable press and hold while typing in vscode
  community.general.osx_defaults:
    domain: com.microsoft.VSCode 
    key: ApplePressAndHoldEnabled
    type: bool
    value: false
    state: present

- name: Get adhoc vscode extensions
  ansible.builtin.find:
    paths: ~/.vscode/extensions/
    file_type: directory
    use_regex: yes
    excludes: '{{ vscode_extensions }}'
    patterns: '.*'
  register: adhoc_vscode_extensions

- name: Delete adhoc vscode extensions
  loop: '{{ adhoc_vscode_extensions.files }}'
  ansible.builtin.file:
    path: '{{ item.path }}'
    state: absent

- name: Install vscode extensions
  loop: "{{ vscode_extensions }}"
  ansible.builtin.command:
    cmd: code --install-extension {{ item }}
    creates: ~/.vscode/extensions/{{ item }}*
